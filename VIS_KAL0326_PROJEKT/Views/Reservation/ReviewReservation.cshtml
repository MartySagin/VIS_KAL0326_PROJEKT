@model DataAccess.Models.Club

@{
    ViewData["Title"] = "Rezervace";

    var reservationDate = (DateTime)ViewBag.ReservationDate;
    var userId = (int)ViewBag.UserId;
}

<h2>Rezervace</h2>

<div class="card mt-4">
    <div class="card-header">
        Detaily klubu
    </div>

    <div class="card-body">
        <h4 class="card-title">@Model.Name</h4>

        <p class="card-text"><strong>Adresa:</strong> @Model.Address</p>
        <p class="card-text"><strong>Typ:</strong> @Model.Type</p>
        <p class="card-text"><strong>Kapacita:</strong> @Model.Capacity 🧑</p>
        <p class="card-text"><strong>Cena za osobu:</strong> @Model.Price Kč</p>
        <p class="card-text"><strong>Popis:</strong> @Model.Description</p>
        <p class="card-text"><strong>Služby:</strong> @Model.Services</p>
    </div>
</div>

<div class="card mt-4">
    <div class="card-header">
        Shrnutí rezervace
    </div>

    <div class="card-body">
        <form id="reservationForm" method="post" asp-controller="Reservation" asp-action="CreateReservation">
            <p><strong>Datum rezervace:</strong> @reservationDate.ToString("dd.MM.yyyy")</p>

            <div class="form-group">
                <label for="numberOfPeople"><strong>Počet osob:</strong></label>
                <input type="number" id="numberOfPeople" name="NumberOfPeople" class="form-control" value="1" required />
            </div>

            <input type="hidden" name="ClubId" value="@Model.ClubId" />

            <input type="hidden" name="UserId" value="@userId" />

            <input type="hidden" name="ReservationDate" value="@reservationDate.ToString("yyyy-MM-dd")" />

            <input type="hidden" id="totalPriceHidden" name="Price" value="@Model.Price" />

            <p class="mt-3"><strong>Celková cena:</strong> <span id="totalPrice">@Model.Price</span> Kč</p>

            <div class="mt-4">
                <a asp-action="Search" asp-controller="Club" class="btn btn-secondary">Zpět</a>

                <button type="submit" class="btn btn-primary">Vytvořit rezervaci</button>
            </div>
        </form>
    </div>
</div>


<script>

    document.getElementById('numberOfPeople').addEventListener('input', function () {
        var numberOfPeople = parseInt(this.value) || 1;
        var maxCapacity = @Model.Capacity;
        var minPeople = 1;

        if (numberOfPeople < minPeople) {
            numberOfPeople = minPeople;
        } else if (numberOfPeople > maxCapacity) {
            numberOfPeople = maxCapacity;
        }

        this.value = numberOfPeople;

        var pricePerPerson = @Model.Price;
        var totalPrice = numberOfPeople * pricePerPerson;

        document.getElementById('totalPrice').innerText = totalPrice;

        document.getElementById('totalPriceHidden').value = totalPrice;
    });
</script>
